# Документация по использованию `platform_update.py`, `platform_start.py`, `platform_stop.py`, `platform_restart.py`

## Требования

- интерпретатор Python версии не ниже 3.4.3;
- дополнительные пакеты для Python: pyyaml;
- поддерживаемые веб-сервера: Apache и IIS (только Windows);
- поддерживаемые версии Apache: 2.0-2.4;
- поддерживаемые версии IIS: 5.1 - 10.0;
- Linux:
  - наличие системы инициализации Systemd и поддержка D-Bus;
  - для запуска веб-сервера его сервис должен называться 'apache2';
- Windows:
  - версия ОС не ниже Windows XP;
  - для запуска веб-сервера его сервис должен называться 'Apache2.x', в зависимости от установленной версии Apache.

## Подготовка

Перед использованием необходимо установить необходимые зависимости в Python (содержатся в файле `requirements.txt` в корне репозитория; зависимости можно установить командой `pip install -r requirements.txt`).

## Использование

Запуск скрипта выполняется следующей командой:

    $ <интерпретатор Python> <имя+путь к скрипту> <имя+путь к конфигурации> [<аргументы для скрипта>]

то есть, например, находясь в родительской, относительно скрипта, директории и имея файл конфигурации в папке configs, вызов скрипта будет выглядеть следующим образом:

    $ python3 AutomationLibrary/platform_update.py configs/platform_update.yaml --new-version=8.3.10.2466

Аргументы для скрипта (как перечисленные в `external-values`, так и в `defalut-values`) можно передавать через командную строку в виде `--<ключ>[=<значение>]`. Если `<значение>` отсутствует, то соответствуюему ключу будет соответствовать Python’овское значение `True`. Для установки “вложенных” значений, то есть, например, находящихся в конфигурации по “адресу” `[“service-1c”][“login”]`, можно указывать все значения ключей через слэш, то есть как `--service-1c/login=Username`.

Передача через командную строку аргументов, указанных в `external-values`, **ОБЯЗАТЕЛЬНА**!

## Организация хранения дистрибутивов для скрипта `platform_update.py`

Путь, в котором хранится копия дистрибутива, указывается в параметре `distr-folder` (в файле конфигурации или в командной строке).

При этом скрипт автоматически добавляет к этому пути номер версии платформы, то есть если в `distr-folder` указано `/var/1c_distros/linux`, и в `new-version` указано `8.3.10.2466`, то в итоге дистрибутив будет искаться по пути `/var/1c_distros/linux/8.3.10.2466`.

Для Linux: скрипт ожидает дистрибутив в виде архива .tar.gz, в котором содержатся необходимые пакеты (для DEB-систем это deb.tar.gz для 32-битных версий и deb64.tar.gz для 64-версия, для RPM-систем: rpm.tar.gz и rpm64.tar.gz).

Для Windows: скрипт ожидает, что дистрибутив будет представлен в разархивированном виде, то есть в папке будут лежать или файлы установщика платформы (`setup.exe` и другие файлы), или уже установленная версия платформы (то есть содержание ее папки `bin`, в которой лежат `ragent.exe`, `ras.exe` и т.д.).

## Документация к коду

Код содержит комментарии в формате утилиты `doxygen`. В корне репозитория лежит файл конфигурации `Doxyfile`, который можно использовать для сборки документации в виде HTML, PDF и других форматов, поддерживаемых `doxygen`.
